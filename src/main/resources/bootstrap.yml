micronaut:
  server:
    port: 18086
    cors:
      enabled: true
  #      configurations:
  #        web:
  #          allowedOrigins:
  #          - *
  #      - http://foo.com
  #      - ^http(|s)://www\.google\.com$

  router:
    static-resources:
      public:
        enabled: true
        paths: classpath:public
        mapping: /**
  application:
    name: smokefree-initiative-service
  security:
    enabled: true
    endpoints:
      login:
        enabled: true
      logout:
        enabled: true
      oauth:
        # TODO: is oauth needed? we're not refreshing on the server when 'implicit grant' flow?
        enabled: true
      beans:
        enabled: true
        sensitive: true
      info:
        enabled: true
        sensitive: false
    intercept-url-map:
    - pattern: /schema.graphql
      http-method: GET
      access:
      - isAnonymous()
    token:
      enabled: true
      jwt:
        enabled: true
        algorithm: HS256
        bearer:
          enabled: true
          header-name: "Authorization"
          prefix: "Bearer"
        signature:
          enabled: true
          rsa:
            enabled: true
            algorithm: HS256
      #        signatures:
      #          secret:
      #            generator:
      #              secret: pleaseChangeThisSecretForANewOne
      # http://guides.micronaut.io/micronaut-token-propagation/guide/index.html
      # https://docs.micronaut.io/snapshot/guide/index.html#tokenPropagation
      writer:
        header:
          enabled: true
        propagation:
          enabled: true
          service-id-regex: "userecho"

## SSL probably not necessary since it's transparently handled by Istio
#  ssl:
#    enabled: true
#    buildSelfSigned: true
---
mongodb:
  uri: "mongodb://${MONGO_HOST:localhost}:${MONGO_PORT:27017}"
---
redis:
  uri: redis://localhost
---
tracing:
  jaeger:
    enabled: true
    sampler:
      probability: 0.1
---
# https://docs.micronaut.io/latest/guide/index.html#jsonBinding
jackson:
  serialization:
    indentOutput: true
    writeDatesAsTimestamps: false
  deserialization:
    useBigIntegerForInts: true
    failOnUnknownProperties: false
